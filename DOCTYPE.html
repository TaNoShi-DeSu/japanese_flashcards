<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>基礎50音學習</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.4; }
  h1, h2 { margin-bottom: 10px; }
  table { border-collapse: collapse; margin-bottom: 20px; width: 100%; max-width: 800px; }
  th, td { border: 1px solid #ccc; text-align: center; padding: 6px; vertical-align: middle; }
  button { cursor: pointer; padding: 4px 8px; font-size: 1rem; }
  #backButton {
    margin-bottom: 20px;
    background-color: #eee;
    border: 1px solid #ccc;
    padding: 6px 12px;
  }
  .romaji { font-size: 0.85rem; color: #555; margin-top: 4px; }
</style>
</head>
<body>

<h1>基礎50音學習</h1>
<button id="backButton" onclick="goBack()">返回目錄</button>

<div>
  <label for="voiceSelect">聲線：</label>
  <select id="voiceSelect"></select>

  <label for="rateRange">語速：</label>
  <input type="range" id="rateRange" min="0.2" max="2" step="0.1" value="0.5" />
  <span id="rateValue">0.5</span>
</div>

<h2>五十音圖 (平假名 / 片假名)</h2>
<table>
  <thead>
    <tr>
      <th>あ段</th><th>い段</th><th>う段</th><th>え段</th><th>お段</th>
    </tr>
  </thead>
  <tbody id="gojuonTable"></tbody>
</table>

<h2>濁音・半濁音</h2>
<table>
  <thead>
    <tr>
      <th>平假名</th><th>片假名</th><th>羅馬拼音</th><th>播放</th>
    </tr>
  </thead>
  <tbody id="dakutenTable"></tbody>
</table>

<h2>拗音 (Yōon)</h2>
<table>
  <thead>
    <tr>
      <th>平假名</th><th>片假名</th><th>羅馬拼音</th><th>播放</th>
    </tr>
  </thead>
  <tbody id="yoonTable"></tbody>
</table>

<h2>長音 & 短音示意</h2>
<table>
  <thead>
    <tr><th>詞語</th><th>羅馬拼音</th><th>播放</th></tr>
  </thead>
  <tbody id="longShortTable"></tbody>
</table>

<script>
  function goBack() {
    window.location.href = "index.html"; // 請依實際路徑調整
  }

  const gojuon = [
    [{ hira:"あ", kata:"ア", romaji:"a" },
     { hira:"い", kata:"イ", romaji:"i" },
     { hira:"う", kata:"ウ", romaji:"u" },
     { hira:"え", kata:"エ", romaji:"e" },
     { hira:"お", kata:"オ", romaji:"o" }],
    [{ hira:"か", kata:"カ", romaji:"ka" },
     { hira:"き", kata:"キ", romaji:"ki" },
     { hira:"く", kata:"ク", romaji:"ku" },
     { hira:"け", kata:"ケ", romaji:"ke" },
     { hira:"こ", kata:"コ", romaji:"ko" }],
    [{ hira:"さ", kata:"サ", romaji:"sa" },
     { hira:"し", kata:"シ", romaji:"shi" },
     { hira:"す", kata:"ス", romaji:"su" },
     { hira:"せ", kata:"セ", romaji:"se" },
     { hira:"そ", kata:"ソ", romaji:"so" }],
    [{ hira:"た", kata:"タ", romaji:"ta" },
     { hira:"ち", kata:"チ", romaji:"chi" },
     { hira:"つ", kata:"ツ", romaji:"tsu" },
     { hira:"て", kata:"テ", romaji:"te" },
     { hira:"と", kata:"ト", romaji:"to" }],
    [{ hira:"な", kata:"ナ", romaji:"na" },
     { hira:"に", kata:"ニ", romaji:"ni" },
     { hira:"ぬ", kata:"ヌ", romaji:"nu" },
     { hira:"ね", kata:"ネ" , romaji:"ne" },
     { hira:"の", kata:"ノ", romaji:"no" }],
    [{ hira:"は", kata:"ハ", romaji:"ha" },
     { hira:"ひ", kata:"ヒ", romaji:"hi" },
     { hira:"ふ", kata:"フ", romaji:"fu" },
     { hira:"へ", kata:"ヘ", romaji:"he" },
     { hira:"ほ", kata:"ホ", romaji:"ho" }],
    [{ hira:"ま", kata:"マ", romaji:"ma" },
     { hira:"み", kata:"ミ", romaji:"mi" },
     { hira:"む", kata:"ム", romaji:"mu" },
     { hira:"め", kata:"メ", romaji:"me" },
     { hira:"も", kata:"モ", romaji:"mo" }],
    [{ hira:"や", kata:"ヤ", romaji:"ya" },
     { hira:"", kata:"", romaji:"" },
     { hira:"ゆ", kata:"ユ", romaji:"yu" },
     { hira:"", kata:"", romaji:"" },
     { hira:"よ", kata:"ヨ", romaji:"yo" }],
    [{ hira:"ら", kata:"ラ", romaji:"ra" },
     { hira:"り", kata:"リ", romaji:"ri" },
     { hira:"る", kata:"ル", romaji:"ru" },
     { hira:"れ", kata:"レ", romaji:"re" },
     { hira:"ろ", kata:"ロ", romaji:"ro" }],
    [{ hira:"わ", kata:"ワ", romaji:"wa" },
     { hira:"", kata:"", romaji:"" },
     { hira:"", kata:"", romaji:"" },
     { hira:"", kata:"", romaji:"" },
     { hira:"を", kata:"ヲ", romaji:"wo" }],
    [{ hira:"ん", kata:"ン", romaji:"n" },
     { hira:"", kata:"", romaji:"" },
     { hira:"", kata:"", romaji:"" },
     { hira:"", kata:"", romaji:"" },
     { hira:"", kata:"", romaji:"" }]
  ];

  const dakuten = [
    { hira:"が", kata:"ガ", romaji:"ga" },
    { hira:"ぎ", kata:"ギ", romaji:"gi" },
    { hira:"ぐ", kata:"グ", romaji:"gu" },
    { hira:"げ", kata:"ゲ", romaji:"ge" },
    { hira:"ご", kata:"ゴ", romaji:"go" },

    { hira:"ざ", kata:"ザ", romaji:"za" },
    { hira:"じ", kata:"ジ", romaji:"ji" },
    { hira:"ず", kata:"ズ", romaji:"zu" },
    { hira:"ぜ", kata:"ゼ", romaji:"ze" },
    { hira:"ぞ", kata:"ゾ", romaji:"zo" },

    { hira:"だ", kata:"ダ", romaji:"da" },
    { hira:"ぢ", kata:"ヂ", romaji:"ji" },  // 注意這裡讀音ji(じ)同じ
    { hira:"づ", kata:"ヅ", romaji:"zu" }, // 注意讀音zu(ず)同じ
    { hira:"で", kata:"デ", romaji:"de" },
    { hira:"ど", kata:"ド", romaji:"do" },

    { hira:"ば", kata:"バ", romaji:"ba" },
    { hira:"び", kata:"ビ", romaji:"bi" },
    { hira:"ぶ", kata:"ブ", romaji:"bu" },
    { hira:"べ", kata:"ベ", romaji:"be" },
    { hira:"ぼ", kata:"ボ", romaji:"bo" },

    { hira:"ぱ", kata:"パ", romaji:"pa" },
    { hira:"ぴ", kata:"ピ", romaji:"pi" },
    { hira:"ぷ", kata:"プ", romaji:"pu" },
    { hira:"ぺ", kata:"ペ", romaji:"pe" },
    { hira:"ぽ", kata:"ポ", romaji:"po" }
  ];

  const yoon = [
    { hira:"きゃ", kata:"キャ", romaji:"kya" },
    { hira:"きゅ", kata:"キュ", romaji:"kyu" },
    { hira:"きょ", kata:"キョ", romaji:"kyo" },

    { hira:"しゃ", kata:"シャ", romaji:"sha" },
    { hira:"しゅ", kata:"シュ", romaji:"shu" },
    { hira:"しょ", kata:"ショ", romaji:"sho" },

    { hira:"ちゃ", kata:"チャ", romaji:"cha" },
    { hira:"ちゅ", kata:"チュ", romaji:"chu" },
    { hira:"ちょ", kata:"チョ", romaji:"cho" },

    { hira:"にゃ", kata:"ニャ", romaji:"nya" },
    { hira:"にゅ", kata:"ニュ", romaji:"nyu" },
    { hira:"にょ", kata:"ニョ", romaji:"nyo" },

    { hira:"ひゃ", kata:"ヒャ", romaji:"hya" },
    { hira:"ひゅ", kata:"ヒュ", romaji:"hyu" },
    { hira:"ひょ", kata:"ヒョ", romaji:"hyo" },

    { hira:"みゃ", kata:"ミャ", romaji:"mya" },
    { hira:"みゅ", kata:"ミュ", romaji:"myu" },
    { hira:"みょ", kata:"ミョ", romaji:"myo" },

    { hira:"りゃ", kata:"リャ", romaji:"rya" },
    { hira:"りゅ", kata:"リュ", romaji:"ryu" },
    { hira:"りょ", kata:"リョ", romaji:"ryo" }
  ];

  const longShortExamples = [
    { word:"おばあさん", romaji:"obaasan" },
    { word:"おばさん", romaji:"obasan" },
    { word:"こうこう", romaji:"koukou" },
    { word:"ここ", romaji:"koko" },
    { word:"おとうさん", romaji:"otousan" },
    { word:"おとさん", romaji:"otosan" }
  ];

  const gojuonTable = document.getElementById("gojuonTable");
  gojuon.forEach(row => {
    const tr = document.createElement("tr");
    row.forEach(cell => {
      if(cell.hira) {
        tr.innerHTML += `
          <td>
            <button class="playBtn" data-text="${cell.hira}" title="播放 ${cell.hira}">${cell.hira}<br>${cell.kata}<br><span class="romaji">${cell.romaji}</span></button>
          </td>`;
      } else {
        tr.innerHTML += `<td></td>`;
      }
    });
    gojuonTable.appendChild(tr);
  });

  const dakutenTable = document.getElementById("dakutenTable");
  dakuten.forEach(({ hira, kata, romaji }) => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td><button class="playBtn" data-text="${hira}" title="播放 ${hira}">${hira}</button></td>
      <td>${kata}</td>
      <td>${romaji}</td>
      <td><button class="playBtn" data-text="${hira}">播放</button></td>
    `;
    dakutenTable.appendChild(tr);
  });

  const yoonTable = document.getElementById("yoonTable");
  yoon.forEach(({ hira, kata, romaji }) => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td><button class="playBtn" data-text="${hira}" title="播放 ${hira}">${hira}</button></td>
      <td>${kata}</td>
      <td>${romaji}</td>
      <td><button class="playBtn" data-text="${hira}">播放</button></td>
    `;
    yoonTable.appendChild(tr);
  });

  const longShortTable = document.getElementById("longShortTable");
  longShortExamples.forEach(({ word, romaji }) => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td><button class="playBtn" data-text="${word}" title="播放 ${word}">${word}</button></td>
      <td>${romaji}</td>
      <td><button class="playBtn" data-text="${word}">播放</button></td>
    `;
    longShortTable.appendChild(tr);
  });

  // 聲音與語速控制
  let voices = [];
  let voiceSelect = document.getElementById("voiceSelect");
  let rateRange = document.getElementById("rateRange");
  let rateValue = document.getElementById("rateValue");
  let initialized = false;

  function populateVoiceList() {
    voices = speechSynthesis.getVoices().filter(v => v.lang.startsWith("ja"));
    voiceSelect.innerHTML = "";
    if (voices.length > 0) {
      voices.forEach((v,i) => {
        voiceSelect.innerHTML += `<option value="${i}">${v.name}</option>`;
      });
      const kyotoIndex = voices.findIndex(v => v.name.toLowerCase().includes("kyoto"));
      voiceSelect.value = kyotoIndex >= 0 ? kyotoIndex : 0;
    } else {
      voiceSelect.innerHTML = `<option>（找不到日文聲線）</option>`;
    }
  }

  if ('onvoiceschanged' in speechSynthesis) {
    speechSynthesis.onvoiceschanged = populateVoiceList;
  } else {
    populateVoiceList();
  }

  rateRange.addEventListener("input", () => {
    rateValue.textContent = rateRange.value;
  });

  document.body.addEventListener("click", (e) => {
    if(e.target.classList.contains("playBtn")) {
      if (!initialized) {
        populateVoiceList();
        initialized = true;
      }
      speak(e.target.getAttribute("data-text"));
    }
  });

  function speak(text) {
    if(!text) return;
    speechSynthesis.cancel();
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = "ja-JP";

    const voiceIndex = voiceSelect.value;
    if(voices.length > 0 && voices[voiceIndex]) {
      utterance.voice = voices[voiceIndex];
    }
    utterance.rate = parseFloat(rateRange.value);
    speechSynthesis.speak(utterance);
  }
</script>

</body>
</html>
